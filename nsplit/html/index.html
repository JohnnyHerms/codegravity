<html>
    <head>
        <title>Code Gravity</title>
        <link href="css/index.css" rel="stylesheet" />
    </head>
    <body>
        <div id="middle">
            <h3>Code Gravity</h3>
            <p>
                Analyze your assembly: 
                <input id="assembly" type="text" placeholder="Enter assembly full local path eg. 'c:\temp\Some.Assembly.dll'" />
                <button id="analyze">Analyze</button>
            </p>
            <p>
                Analyze the default assembly:
                <button id="demo">Demo</button>
            </p>
            <div id="progressArea">
                <p>
                    Assembly: <span id="loaded"></span><br/>
                    Analyzes: <span id="message"></span><br/>
                    Progress: <span id="progress"></span>
                </p>
            </div>
            <p>You will be redirected automatically when dependency graph is complete.</p>
            <p>You can still <button id="goto" disabled="disabled">go to graph</button> anyway and see the incomplete dependency graph.</p>
            <p>The graph can be realoaded anytime by clicking (F5) and newly discovered dependencies will show up.</p>
            <p>Use mouse wheel to zoom, drag surface to pan.</p>
            <p>You can also:</p>
            <ul>
                <li>mouse over nodes</li>
                <li>click nodes</li>
                <li>drag nodes</li>
                <li>expand/collapse the tree</li>
                <li>check/uncheck tree nodes</li>
            </ul>
        </div>
    </body>
    
    <script src="js/lib/jquery.js"> </script> 
    <script>
        $(document).ready(function() {
            $("#analyze").on("click", function() {
                var fileName = $("#assembly").val();
                startAnalyzes(fileName);
            });

            $("#demo").on("click", function() {
                startAnalyzes("");
            });
        });

        function startAnalyzes(file) {
            $.getJSON("api/analyzes/start?file=" + file, function(data) {
                $("#loaded").text(data.message);
                $("#message").text("Started");
                if (data.ok) {
                    setTimeout(getPorgress, 100);
                    $("#goto")
                        .removeAttr("disabled")
                        .on("clilc", goToGraph);
                }
            });
        }

        function getPorgress() {
            $.getJSON("api/analyzes/progress", function(progress) {
                $("#progress").text(Math.round(progress.actual * 100 / progress.max) + "%");
                $("#message").text(progress.message);
                if (progress.finished) goToGraph();
                else setTimeout(getPorgress, 200);
            });
        }

        function goToGraph() {
            window.location.href = "main.html";
        }

    </script>   
</html>